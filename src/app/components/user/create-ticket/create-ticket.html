<div class="create-ticket-container">
  <mat-card class="form-card">
    <mat-card-header>
      <div class="header-content">
        <h1><mat-icon>add_circle</mat-icon> Create New Ticket</h1>
        <p>Submit a support request and we'll get back to you shortly</p>
      </div>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
        
        <!-- Title -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ticket Title</mat-label>
          <input matInput formControlName="title" placeholder="Brief description of your issue">
          <mat-icon matSuffix>title</mat-icon>
          <mat-error *ngIf="ticketForm.get('title')?.hasError('required')">
            Title is required
          </mat-error>
          <mat-error *ngIf="ticketForm.get('title')?.hasError('minlength')">
            Title must be at least 5 characters
          </mat-error>
          <mat-error *ngIf="ticketForm.get('title')?.hasError('maxlength')">
            Title cannot exceed 200 characters
          </mat-error>
        </mat-form-field>

        <!-- Category -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category.value">
              {{ category.label }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>category</mat-icon>
          <mat-error *ngIf="ticketForm.get('category')?.hasError('required')">
            Please select a category
          </mat-error>
        </mat-form-field>

        <!-- Description -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea 
            matInput 
            formControlName="description" 
            rows="8"
            placeholder="Provide detailed information about your issue...">
          </textarea>
          <mat-icon matSuffix>description</mat-icon>
          <mat-hint>Please be as detailed as possible (minimum 20 characters)</mat-hint>
          <mat-error *ngIf="ticketForm.get('description')?.hasError('required')">
            Description is required
          </mat-error>
          <mat-error *ngIf="ticketForm.get('description')?.hasError('minlength')">
            Description must be at least 20 characters
          </mat-error>
        </mat-form-field>

        <!-- Tags -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tags (Optional)</mat-label>
          <mat-chip-grid #chipGrid>
            <mat-chip-row *ngFor="let tag of tags" (removed)="removeTag(tag)">
              {{ tag }}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          </mat-chip-grid>
          <input 
            placeholder="Add tags (press Enter)..."
            [matChipInputFor]="chipGrid"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addTag($event)">
          <mat-icon matSuffix>label</mat-icon>
          <mat-hint>Press Enter to add tags (max 10)</mat-hint>
        </mat-form-field>

        <!-- File Upload -->
        <div class="file-upload-section">
          <h3><mat-icon>attach_file</mat-icon> Attachments (Optional)</h3>
          
          <button 
            type="button" 
            mat-stroked-button 
            color="primary" 
            (click)="fileInput.click()">
            <mat-icon>upload_file</mat-icon>
            Select Files
          </button>
          
          <input 
            #fileInput 
            type="file" 
            multiple 
            style="display: none;"
            (change)="onFileSelect($event)"
            accept="image/*,.pdf,.doc,.docx,.txt">
          
          <p class="file-hint">Max 5MB per file. Supported: Images, PDF, DOC, TXT</p>

          <!-- Selected Files List -->
          <div *ngIf="selectedFiles.length > 0" class="selected-files">
            <h4>Selected Files ({{ selectedFiles.length }})</h4>
            <mat-chip-set>
              <mat-chip *ngFor="let file of selectedFiles; let i = index" (removed)="removeFile(i)">
                <mat-icon matChipAvatar>insert_drive_file</mat-icon>
                {{ file.name }} ({{ getFileSize(file.size) }})
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            type="button" 
            mat-stroked-button 
            (click)="cancel()"
            [disabled]="loading">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
          
          <button 
            type="submit" 
            mat-raised-button 
            color="primary"
            [disabled]="ticketForm.invalid || loading">
            <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!loading">send</mat-icon>
            {{ loading ? 'Creating...' : 'Create Ticket' }}
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>
</div>
